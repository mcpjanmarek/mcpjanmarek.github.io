---
id: 37
title: Microsoft SQL Server 2005 – správa security
date: 2010-01-01T09:24:00+02:00
author: Jan Marek
layout: post
guid: 'http://jmarek.wordpress.com/2010/01/01/microsoft-sql-server-2005-%e2%80%93-sprava-security'
permalink: /2010/01/01/microsoft-sql-server-2005-sprava-security/
spaces_1d3f038117de6df561f7bf0516bb226c_permalink:
  - "http://cid-6e7b9216726d07b8.users.api.live.net/Users(7961117391414167480)/Blogs('6E7B9216726D07B8!242')/Entries('6E7B9216726D07B8!314')?authkey=EpZNAU0huAk%24"
  - "http://cid-6e7b9216726d07b8.users.api.live.net/Users(7961117391414167480)/Blogs('6E7B9216726D07B8!242')/Entries('6E7B9216726D07B8!314')?authkey=EpZNAU0huAk%24"
categories:
  - Nezařazené
  - SQL Server
---
<div id="msgcns!6E7B9216726D07B8!314" class="bvMsg">
  <p>
    <a href="http://janmarek.eu/wp-content/uploads/2010/10/sqlserver20055b45d07172dfd.png" rel="WLPP"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;margin:0 10px 0 0;" title="sqlserver2005" border="0" alt="sqlserver2005" align="left" src="/wp-content/uploads/2010/10/sqlserver20055b45d07172dfd.png?w=290" width="240" height="66" /></a> &#8211; pravo PUBLIC na db = pouze pravo connect k db &#8211; a ostatni prava se pak nasledne ridi pravy GUEST<br />&#8211; role &#8211; rovnocena skupine uzivatelu => pokud pouzivam AD groups, tak vlastne mi jsou role k nicemu<br />&#8211; aplikacni role &#8211; protoze sice davam uzivateli plna prava k db, chci mu ji dat jen pomoci nejake aplikace<br />&#8211; schema &#8211; rovnocena skupine objektu &#8211; slouzi jako nositele opravneni a zjednodusuje si jimi pridelovani prav<br />&#8211; vsechny loginy jsou v sys.db master v tabluce syslogins (pro jejich vypis tedy "SELECT * FROM sys.syslogins" &#8211; zde jsou i hesla u SQL loginu, ale zahashovane)<br />&#8211; login &#8211; umoznuje se pripojit k SQL serveru/instanci<br />&#8211; user &#8211; umoznuje se pripojit k SQL db (pro jejich vypis pouziji onu db a dam "SELECT * FROM sys.users") &#8211; pozor pri jeho vytvareni na checkboxy Enforce Password Policy (pokud je SQLserver v domene, tak si nacte GPO a aplikuje si password policy z ni / pokud neni v domene tak se ridi Local Security Policy na serveru == ignoruje ale nastaveni Password History a Password Age) a Enforce Policy Expiration (pokud zustane zaskrtnuto Change Password on next, tak si uzivatel nemuze prihlasit k SQL napr. pres sqlcmd, protoze tam nema moznost zmenit si to heslo<br />&#8211; mapping user+login &#8211; je 1:1 (pokud se uz vaze jeden db user na jeden srv login, tak uz dalsi db user k tomu srv loginu neudelam!!)<br />&#8211; pokud je WinUser clenem jeste WinGroup a WinUser mel udelany SQL Login a WinGroup mela taky SQL Login, tak overeni se provede na zaklade WinUser, protoze pri overovani Windows se v Tokenu posila nejdrive SIDUser a teprve potom SIDGroups (to je natvrdo ve Win)<br />&#8211; toto umoznuje prenos db, protoze ta obsahuje users, ale musim pak jeste prenest i master db, nebo alespon loginy mapovane na users<br />&#8211; objekty v db &#8211; (pro jejich vypis pouziji onu db a dam "SELECT * FROM sys.sysobjects")<br />&#8211; prava na objekty &#8211; (pro jejich vypis pouziji onu db a dam "SELECT * FROM sys.sysprotects") &#8211; reseno primitivne temito (a jeste dalsimi) tabulkami, a tyto musi SQL server projit, aby zjistil prava &#8211; proto je to vsechno nabufferovane v RAM, aby byla odpoved okamzita /// objekt ma nejvyssi prioritu ohledne prav<br />&#8211; 3 stupne efektivnich prav na urovni SQL (na urovni Windows je to ACL) = grant/revoke/deny (deny ma nejvyssi prioritu)<br />-aplikacni role &#8211; daji se ji prava povysit i ponizit &#8211; vytvori se role, uzivatel se prihlasi (nastavi se mu prava podle user prav), pak zavola <br />sp_setapprole nazevrole, heslorole a nyni ma prava presne takova, ktera ma approle<br />-1. vytvorim login (= uroven SQL server/instance) &#8211; zvolim authentikaci, server role, default language (podle tohoto nastaveni se zobrazuji zpravy tomu uzivateli &#8211; musi samozrejme byt nainstalovane znakove sady onoho jazyka ve Win) &#8211; v tuto chvili se muze pripojit pouze k sys. dbs<br />-2. vytvorim user (= uroven db) &#8211; vlastnosti loginu &#8211; user mapping &#8211; zaskrtnu databazi a tim se vytvori user na te one db &#8212; zvolim mu default schema (tim mu jen jakoby priradim vychozi prekladani)<br />Keys and Certificates<br />&#8211; symmetric key &#8211; jako klic u dveri &#8211; odemykam i zamykam nim (kdyz ho ztratim, tak ho nekdo kompletne pouzije)<br />&#8211; asymmetric key &#8211; je to par &#8211; nejcasteji se pouziva s certifikaty, ktere ho vylepsuji<br />&#8211; v SQL se daji vytvorit pouze 1kB klice, vetsi klice se musi vytvorit mimo a pak je naimportovat do SQL<br />&#8211; service master key (asymm) &#8211; vytvori se automaticky pri instalaci!<br />&#8211; db master key (asymm) &#8211; muze se vytvorit na db a po vytvoreni se kopiruje do master db, takze pozor na to<br />&#8211; certificate &#8211; pouziva se k podepisovani aplikace (pri editace aplikace se klic porusi), k sifrovani dat v tabulkach/desifrovani<br />&#8211; &#8211; k namapovani user na certifikat<br />SQL Server 2005 Best Practise Analyzer &#8211; vyborna utilita na audit security</div>

