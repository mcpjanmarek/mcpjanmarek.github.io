---
id: 40
title: Microsoft SQL Server 2005 – disaster recovery
date: 2010-01-01T09:21:00+02:00
author: Jan Marek
layout: post
guid: 'http://jmarek.wordpress.com/2010/01/01/microsoft-sql-server-2005-%e2%80%93-disaster-recovery'
permalink: /2010/01/01/microsoft-sql-server-2005-disaster-recovery/
spaces_1d3f038117de6df561f7bf0516bb226c_permalink:
  - "http://cid-6e7b9216726d07b8.users.api.live.net/Users(7961117391414167480)/Blogs('6E7B9216726D07B8!242')/Entries('6E7B9216726D07B8!311')?authkey=EpZNAU0huAk%24"
  - "http://cid-6e7b9216726d07b8.users.api.live.net/Users(7961117391414167480)/Blogs('6E7B9216726D07B8!242')/Entries('6E7B9216726D07B8!311')?authkey=EpZNAU0huAk%24"
categories:
  - Nezařazené
  - SQL Server
---
<div id="msgcns!6E7B9216726D07B8!311" class="bvMsg">
  <p>
    <a href="/wp-content/uploads/2010/10/sqlserver20055b45d6560a53c.png" rel="WLPP"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;margin:0 10px 0 0;" title="sqlserver2005" border="0" alt="sqlserver2005" align="left" src="/wp-content/uploads/2010/10/sqlserver20055b45d6560a53c.png?w=290" width="240" height="66" /></a> Recovery Model<br />&#8211; Full &#8211; nejvyssi schopnost obnovit db &#8211; zalohuje se db i transact.log (log tedy stale roste)<br />&#8211; Simple &#8211; obnovuje pouze posledni full backup &#8211; pri kazde zaloze db se transact.log vycisti o neaktivni casti<br />&#8211; Bulk-Logged &#8211; je to velmi podobne full, pouze ma mene mista na transact.log<br />&#8211; backup je BEZ komprese!<br />&#8211; role db_operator ma moznost zalohovat konkrektni db<br />&#8211; Backup Device &#8211; je "alias" pro cestu kam zalohovat, aby nebylo potreba pri zmene zalohovaciho umisteni menit vsechny skripty &#8211; resi toto sp_addumpdevice, nebo v konzole Server Objects<br />&#8211; Options v Backup&#8230; Append &#8211; prida na konec souboru dalsi backup (pouziva se pro transact.logy); Overwrite &#8211; prepise cely backup<br />&#8211; Backup Job &#8211; naleza se pak v SQL Agentovi, vysledek Jobu se da nalezt pak hned pod nim v Job Activity Logu, vyberu udalost a dam History (zaroven je to takove v Event Vieweru)<br />&#8211; backup umi mirror &#8211; mohu backupovat soucasne na nekolik mist, ale neumi HDD a TAPE zaroven<br />&#8211; pouzivat vzdy CHECKSUM a Verifikaci<br />&#8211; ohledne FULL recovery modelu &#8211; pokud se nezalohuje kompletne cela db, ale jen nektere jeji soubory, tak se pouziva 1 zaloha db a nekolik zaloh t-logu &#8211; pri restoru se pak udela <b>restore database with recovery</b> (leave the database ready to use), pak postupne vsechny t-logy pomoci <b>restore log with norecovery</b> (leave the database non-operational, behem tohoto se databaze hlasi jako Restoring&#8230;) a na poslednim teprve <b>restore log with with recovery</b><br />Database Snapshot (pouze v Enterprise verzi)<br />&#8211; musi byt na NTFS<br />&#8211; neni nahradou backupu!!!!<br />&#8211; nevytvari logy (pracuje pouze na storage enginu, ne na sessions)<br />&#8211; je pouze read-only &#8211; toho se da vyuzit pro uzivatele, ktery jen potrebuje read k nejakym history data<br />&#8211; behem vytvoreni je prazdny (pouze si alokuje misto na disku, podle velikosti db), teprve az se udela nejaka zmena v db, tak ty jeste nezmenene stranky se kopiruji do snapshotu<br />&#8211; umi i restore cele databaze, pokud se zmenila cela, pomoci <b>restore database db from database_snapshot = &#8218;snapshotdb&#8216;</b> &#8211; mnohem rychlejsi nez backup<br />&#8211; neda se db dropnout, pokud je nad ni snapshot<br />&#8211; prace se snapshotem je pouze pres prikazy &#8211; da se pouzit ovsem sablona z templates (ta je ale pouze pro jeden soubor &#8211; pokud jsou tam tedy dalsi soubory db, tak ty se musi dopsat!!) &#8211; kazdy db soubor ma tedy svuj soubor snapshotu (.ss)<br />Backing Up System Databases<br />&#8211; pokud nemam jejich zalohu, da se pouze provest pouze navrat ke stavu tesne po instalaci &#8211; pomoci "setup.exe /REINSTALLMODE=OMUS"<br />&#8211; pro restore zazalohovane sys. database musim spustit SQL v single-user modu, protoze pri nem se nehleda master db ("sqlservr.exe -c -m")</div>
